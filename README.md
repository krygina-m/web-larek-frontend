# Интернет-магазин Web-larek

# Цель проекта

Web-ларёк - это интернет магазин. В нём можно посмотреть каталог товаров, посмотреть детально каждый товар, добавить товары в корзину и сделать заказ.

# Стек:

- HTML;
- SCSS;
- TS;
- Webpack.

# Структура пректа:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

# Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/index.ts — точка входа приложения
- src/types/index.ts — файл с описанием типов данных (интерфесайми)
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с функциями

## Краткое описание проекта

### Структура

Приложение состоит из главной страницы с карточками товаров и из модальных окон, предназначенных для:

- детального просмотра товара,
- корзины,
- формы указания способа оплаты и адреса доставки,
- формы ввода контактных данных.

При нажатии на карточку товара открывается модальное окно с детальной информацией о товаре.
При нажатии на иконку корзины открывается корзина.
При нажатии на кнопку «Купить» товар добавляется в корзину, если не был добавлен в корзину раньше.
При нажатии на кнопку корзины товар удаляется из корзины.

### Реализация логики

- Валидация форм: если хотя бы одно поле формы не заполнено, кнопка "Далее" и кнопка "Оплатить" не активны.
- Кнопка "Оформить" не активна, если корзина пуста.
- После оформления заказа происходит очистка форм и корзины.
- Взаимодействие с API: массив товаров загружается с сервера, заказ с информацией о пользователе и товарах отправляется на сервер.

### Архитектура

Приложение разработано в стиле MVP на основе готового макета и UI-kit:

1. Определены необходимые сущности и продумана архитектура на основе принципов ООП.
2. Создана документация.
3. Описаны типы используемых данных.

## [Посмотреть проект](https://github.com/krygina-m/web-larek-frontend/)

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```bash
npm install
npm run start
```

или

```bash
yarn
yarn start
```

## Сборка

```bash
npm run build
```

или

```bash
yarn build
```

## Описание ключевых данных

Основные данные проекта представлены интерфейсами IProduct (товар) и IOrder (заказ).

### Интерфейс `IProduct`

Представляет конкретный товар, доступный для приобретения в интернет-магазине, содержит все данные, необходимые для описания товара.

#### Свойства:

- **id**: `string` уникальный идентификатор товара
- **description**: `string` - описание товара
- **image**: `string`- ссылка на изображение товара
- **title**: `string` - название товара
- **category**: `string` - категория товара
- **price**: `number|null` - цена товара

### Интерфейс `IOrder`

Описывает объект заказа отправляемый на сервер. Содержит массив id товаров, добавленных в заказ, данные покупателя и общую сумму заказа.

#### Свойства:

- **payment**: `string` - метод оплаты заказа.
- **email**: `string` - электронная почта пользователя.
- **phone**: `string` - номер телефона пользователя.
- **address**: `string` - адрес доставки.
- **total**: `number` - общая стоимость заказа.
- **items**: `string[]` - массив товаров, составляющих заказ.

### Интерфейс `IBasketModel`

Описывавет модель корзины. Содержит массив товаров в корзине и методы удаления и добавления.

#### Свойства:

- **items**: `Map<K, V>` - список товаров в корзине.
- **add**: `void` - метод добавления товара в корзину.
- **remove**: `void` - метод удаления товара из корзины.
- **purchaseCost**: `number` - метод расчета стоимости корзины.

## Базовый слой

### 1. Класс `View`

Абстрактный класс. Является родительским классом для всех компонентов представления, содержит методы необходимые для работы с DOM.
В конструктор принимает элемент HTML, который будет использоваться в качестве контейнера для компонента.

#### Методы:

- **render(data?: `Partial<T>`)** - отображает переданные данные
- **toggleClass(element: HTMLElement, className: string, state?: boolean)** - переключает класс у элемента
- **setImage** - устанавливает картинку
- **setTextContent** - устанавливает текст
- **setDisabled** - переключает видимость элемента
- **render** - рендеринг

### 2. Класс `Api`

Представляет класс для выполнения HTTP-запросов к внешнему API. Выполняет GET запросы и возвращает ответ с сервера. POST запросы принимают объекты с данными JSON.

#### Конструктор принимает следующие аргументы:

- `baseUrl: string` - базовый URL адрес для запросов. Строковый тип.
- `options: RequestInit` - настройки запроса по умолчанию. Объект типа RequestInit.

#### Вид конструктора:

`constructor(baseUrl: string, options: RequestInit = {})`

#### Используемые методы:

`handleResponse(response: Response): Promise<object>`
Защищенный метод. Принимает объект типа Response. Обрабатывает ответ от сервера и возвращает либо объект данных, либо отклоняет промис с сообщением об ошибке.

`get(uri: string): Promise<object>`
Выполняет GET запрос к URI. Принимает URI в виде строки и возвращает промис с данными ответа.

`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>`
Выполняет POST запрос с переданным URI, данными и методом. Принимает URI в виде строки, объект данных и метод типа ApiPostMethods (строковый литерал). Возвращает промис, возвращающий объект.

### Презентер

### 3. Класс `EventEmitter`

Брокер событий. Может установить и снять слушатели событий, вызвать слушателей при возникновении события.

#### Используемые методы:

- `on(eventName: string, callback: Function): void`
  Добавляет обработчик для указанного события.
  Принимает два параметра:

1. `eventName`: строка - имя события.
2. `callback`: колбэк функции добавления обработчика события.
   Возвращает тип `void`.

- `off(off(eventName: string, callback: Function): void`
  Удаляет обработчик для указанного события.
  Принимает два параметра:

1. `eventName`: строка - имя события.
2. `callback`: колбэк функции удаления обработчика события.
   Возвращает тип `void`.

- `emit: (eventName: string, data: unknown) => void`
  Вызывает указанное событие, сообщая всем, кто на него подписан, о его наступлении. При этом могут передаваться какие-нибудь данные.
  Принимает два параметра:

1. `eventName`: строка - имя события.
2. `data`: данные, необходимые для вызова события.
   Возвращает тип `void`.

- `trigger<T extends object>(eventName: string, context?: Partial<T>): (data: T) => void`
Коллбек триггер, генерирующий событие при вызове. Принимает два параметра:
1. `eventName`: строка - имя события.
2. `context`: данные, необходимые для вызова события.
   Возвращает тип `void`.

- `onAll(callback: (event: EmitterEvent) => void`
  Добавляет обработчик на все события.

- `offAll()`
  Добавляет обработчик на все события.

### 4. Класс `Model`
Абстрактный класс. 

## Слой данных

### 1. Класс `Product` (Продукт)

Класс для товаров.

##### Поля:

- **id?: string** - индивидуальный идентификатор карточки
- **title: string** - заголовок карточки
- **description?: string** - описание карточки товара
- **image?: string** - картинка товара
- **category?: ICategory** - тегория карточки товара
- **price: number | null** - цена товара
- **index?: number** - индекс карточки товара
- **isInBasket?: boolean** - признак нахождения товара в корзине
##### Конструктор

constructor(container: HTMLElement)

##### Методы

- **set id(value: string) / get id(): string** - установить/поучить индивидуальный идентификатор
- **set title(value: string) / get title(): string** - установить/поучить названия карточки товара
- **set image(value: string)** - установить картинку товара
- **set description(value: string)** - установить описание товара
- **set category(value: string) / get category(): string** - установить/поучить категорию товара
- **set price(value: number) / get price(): number** - установить/поучить цену
- **set isInBasket(state: boolean)** - установить признак "товар в корзине"

### 2. Класс `ContactsOrder` (Контакты заказчика)

Класс для хранения информации о контактах заказчика.

##### Поля:

- **email: string** - email заказчика
- **phone: string** - телефон заказчика
- **payment: PaymentMethod** - способ оплаты
- **address: string** - адрес заказчика

##### Методы

- **set email(value: string)** - установить email заказчика
- **set phone(value: string)** - установить телефон заказчика
- **set payment(value: PaymentMethod)** - установить способ оплаты
- **set address(value: string)** - установить адрес заказчика
- **validate(email: string, phone: string, address: string): boolean** - валидация данных формы

### 3. Класс `BasketModel`

Отображает корзину с ее содержимым.

#### Поля:

- **items: Map<string, number>** - массив товаров в корзине

#### Методы:

- **add(id: string)** - метод добавления товара в корзину
- **remove(id: string)** - метод удаления товара из корзины
- **purchaseCost(cost: number): number** - метод расчета суммы покупки

### 4. Класс `FormState`

Проверяет форму на валидность и возвращает массив ошибок.

В конструктор принимает HTML-элемент формы и экземпляр EventEmitter для инициализации событий.

#### Поля:

- **valid: boolean** - логическая переменная, хранящая состояние валидности формы
- **errors: string[]** - массив ошибок

### 5. Класс `CatalogModel`

Модель каталога товаров. Отвечает за хранение и управление списком доступных товаров.

#### Конструктор

Не принимает параметров

#### Поля

- **productList: IProduct[]** - массив товаров каталога
- **preview: string | null** - массив товаров каталога
- **order: Partial<IContactsOrder>** - массив товаров каталога
- **formErrors: IFormErrors** - массив товаров каталога

#### Методы

- **setItems(items: IProduct[]): void** - обновление списка товаров
- **setItem(item: IProduct): void** - обновление товара
- **addProductToBasket(item: IProduct): void** - дабавить позицию в корзину
- **removeProductFromBasket(item: IProduct): void** - удалить позицию корзины
- **getBasketItems(): IProduct[]** - получить позицию корзины
- **getTotalPrice(): number** - получить стоимость корзины
- **setOrderField<T extends keyof IContactsOrder>(field: T value: IContactsOrder[T]): void** - установить поле заказа
- **validateOrder(): boolean** - валидация заказа
- **clearBasket(): void** - очистить данные корзины
- **clearOrder(): void** - очистить данные заказа

## Слой представления

### 1. Класс `PageView`

Является дочерним классом `View`.
Отвечает за расстановку отображаемых элементов на странице, устанавливает элементы в предназначенные для них контейнеры, выводит обновленное значение счетчика товаров после добавления/удаления товара, позволяет блокировать прокрутку страницы, когда поверх нее вызвано модальное окно. Содержит сеттеры для работы с полями.

В конструктор принимает HTML элемент контейнера и экземпляр EventEmitter для инициализации событий.

#### Поля:

- **basketCounter: HTMLElement** - счетчик товаров в корзине
- **productsList: HTMLElement** - каталог товаров
- **wrapper: HTMLElement** - обертка страницы (для блокировки скролла)
- **basket: HTMLElement** - элемент счетчика на главной странице

### 2. Класс `Popup`

Является дочерним классом `View`.
Отображает универсальное модальное окно с кнопкой закрытия. Выводит внутри модального окна любой переданный контент.\
В конструктор принимает элемент контейнера и экземпляр класса `EventEmitter` для инициализации событий. Содержит сеттер для установки контента.

#### Поля:

- **closeButton: HTMLButtonElement** - кнопка закрытия модального окна
- **content: HTMLElement** - разметка для вставки модального окна на страницу

#### Методы:

- **open()** - открытие модального окна
- **close()** - закрытие модального окна по нажатию на кнопку или вне зоны окна
- **handleESC(evt:KeyboardEvent)** - закрытие модального окна по нажатию на ESC
- **render(data: IPopup)** - отображение модального окна

### 3. Класс `SuccessView`

Является дочерним классом View.
Предназначен для отображения сообщения об успешно завершенном заказе с итоговой суммой покупки, которое выводится в контент модального окна.

В конструктор принимает элемент, в который будет выведено сообщение об успешном заказе и функцию, выполняемую при нажатии на кнопку завершения заказа. Содержит сеттер total для установки значения списанных средств.

#### Поля:

- **total: number** - количество списанных средств
- **closeButton: HTMLButtonElement** - количество списанных средств

#### Методы

- **setTotal(total: number): HTMLElement** - установка значения списанных средств

### 4. Класс `FormView`

Представляет собой универсальный компонент формы, является родительским классом для всех форм приложения. Содержит сеттеры для установки значений полей.

В конструктор принимает HTML элемент формы и экземпляр EventEmitter для инициализации событий.

#### Поля:

- **submitButton: HTMLButtonElement** - кнопка сохранения формы
- **errors: HTMLElement** - вывод сообщений об ошибках валидации

#### Методы:

- **onInputChange()** - отслеживание изменений в поле ввода для генерации событий "changed"
- **oclearForm(): void** - очищает форму
- **render(state: `Partial<T>` & IFormState)** - отрисовывает и перерисовывает форму (например, когда нужно вывести сообщении об ошибке при невалидном тексте в поле ввода)

### 5. Класс `BasketView`

Интерфейс описывает основные операции, которые должен поддерживать класс представления корзины.

#### Поля:

- **list: HTMLButtonElement** - список корзины 
- **total: HTMLElement** - сумма
- **button: HTMLElement** - кнопка

#### Методы:

- **set items(items: HTMLElement[])** - установить содержимое корзины
- **set total(total: number)** - установить сумму корзины

## Взаимодействие компонентов

Архитектура проекта реализована в парадигме MVP и состоит из трех основных частей:

1. Слой модели данных, в котором сосредоточена вся внутренняя логика работы с данными.
2. Слой представления, необходимый для работы с элементами разметки и отрисовки элементов на сайте.
3. Презентер, связывающий слой данных со слоем представления.

Процессы в приложении организованы при помощи событийного подхода и реализованы при помощи брокера событий event emitter.

### Перечень событий, генерируемых в системе:

- `catalogModel:change` - событие генерируемое при подгрузке с сервера карточек товара

- `card:select` - выбор карточки

- `basketModel:add` - добавление товара в корзину

- `basketModel:remove` - удаление товара из корзины

- `preview:change` - перерисовать страницу

- `basket:open` - открыть корзину

- `backet:change` - закрыть корзину

- `Form:submit` - сохранение данных в форме

- `formErrors:change` - изменение состояния валидации форм

- `order:open` - открыть форму заполнения данных покупателя

- `сontactsOrder.address:change`- изменение поля ввода адреса доставки

- `сontactsOrder.payment:change` - изменение поля ввода способа оплаты

- `сontactsOrder.email:change` - изменение поля ввода электронной почты

- `сontactsOrder.phone:change` - изменение поля ввода номера телефона

- `order:submit` - успешное заполнения формы

- `popup:open` - открытие модального окна

- `popup:close` - закрытие модального окна



